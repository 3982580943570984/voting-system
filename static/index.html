<!DOCTYPE html>
<html>
  <head>
    <title>JWT Authentication Example with Sign-Up</title>
  </head>

  <body>
    <h1>JWT Authentication with Go Service</h1>

    <!-- Sign-Up Section -->
    <div id="signup-section">
      <h2>Sign Up</h2>
      <form id="signup-form">
        <label>
          Email:
          <input type="text" id="signup-email" required />
        </label>
        <br /><br />
        <label>
          Password:
          <input type="password" id="signup-password" required />
        </label>
        <br /><br />
        <button type="submit">Sign Up</button>
      </form>
      <p>Already have an account? <a href="#" id="show-login">Log In</a></p>
    </div>

    <!-- Login Section -->
    <div id="login-section" style="display: none">
      <h2>Login</h2>
      <form id="login-form">
        <label>
          Email:
          <input type="text" id="login-email" required />
        </label>
        <br /><br />
        <label>
          Password:
          <input type="password" id="login-password" required />
        </label>
        <br /><br />
        <button type="submit">Login</button>
      </form>
      <p>Don't have an account? <a href="#" id="show-signup">Sign Up</a></p>
    </div>

    <script>
      // Show Login Form
      document
        .getElementById("show-login")
        .addEventListener("click", function (e) {
          e.preventDefault();
          document.getElementById("signup-section").style.display = "none";
          document.getElementById("login-section").style.display = "block";
        });

      // Show Sign-Up Form
      document
        .getElementById("show-signup")
        .addEventListener("click", function (e) {
          e.preventDefault();
          document.getElementById("login-section").style.display = "none";
          document.getElementById("signup-section").style.display = "block";
        });

      // Sign-Up Form Submission
      document
        .getElementById("signup-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const email = document.getElementById("signup-email").value;
          const password = document.getElementById("signup-password").value;

          fetch("http://localhost:3000/signup", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email: email, password: password }),
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Sign-up failed");
              }
              return response.json();
            })
            .then((data) => {
              alert("Sign-up successful! Please log in.");
              // Clear the sign-up form
              document.getElementById("signup-form").reset();
              // Switch to login form
              document.getElementById("signup-section").style.display = "none";
              document.getElementById("login-section").style.display = "block";
            })
            .catch((error) => {
              alert(error.message);
            });
        });

      // Login Form Submission
      document
        .getElementById("login-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const email = document.getElementById("login-email").value;
          const password = document.getElementById("login-password").value;

          fetch("http://localhost:3000/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email: email, password: password }),
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Login failed");
              }
              return response.json();
            })
            .then((data) => {
              // Store JWT token in localStorage
              localStorage.setItem("jwt_token", data.token);

              // Redirect to elections page
              window.location.href = "elections.html";
            })
            .catch((error) => {
              alert(error.message);
            });
        });

      // Logout Functionality
      document.getElementById("logout").addEventListener("click", function () {
        localStorage.removeItem("jwt_token");
        document.getElementById("protected-section").style.display = "none";
        document.getElementById("login-section").style.display = "block";
        document.getElementById("login-form").reset();
      });

      // Check if user is already logged in
      window.onload = function () {
        const token = localStorage.getItem("jwt_token");
        if (token) {
          document.getElementById("signup-section").style.display = "none";
          document.getElementById("login-section").style.display = "none";
          document.getElementById("protected-section").style.display = "block";
        } else {
          document.getElementById("signup-section").style.display = "block";
        }
      };
    </script>
  </body>
</html>
